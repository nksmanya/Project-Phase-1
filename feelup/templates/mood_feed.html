{% extends "base.html" %}
{% block title %}Mood Feed - FeelUP{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-heart gradient-text"></i> Mood Feed</h2>
    <span class="badge badge-primary"><i class="fas fa-users"></i> {{ moods|length }} Posts</span>
  </div>

  <!-- Post Form -->
  <div class="card p-4 mb-4 shadow-hover" style="border-left: 5px solid #667eea;">
    <h5 class="mb-3"><i class="fas fa-plus-circle"></i> Share Your Mood</h5>
    <form method="POST">
      <div class="mb-3">
        <textarea name="content" class="form-control" rows="4" placeholder="How are you feeling today? üí≠" required></textarea>
      </div>
      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label"><i class="fas fa-smile"></i> Emotion</label>
          <select name="emotion" class="form-select">
            <option value="">ü§ñ Auto-detect</option>
            <option value="positive">üòä Positive</option>
            <option value="neutral">üòê Neutral</option>
            <option value="negative">üòî Negative</option>
          </select>
        </div>
        <div class="col-md-6 d-flex align-items-end">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" name="anonymous" id="anonCheck">
            <label class="form-check-label" for="anonCheck">
              <i class="fas fa-user-secret"></i> Post Anonymously
            </label>
          </div>
        </div>
      </div>
      <button class="btn btn-primary" type="submit">
        <i class="fas fa-paper-plane"></i> Share Mood
      </button>
    </form>
  </div>

  <!-- Mood Posts -->
  <div class="row">
    {% for mood in moods %}
    <div class="col-md-6 mb-4">
      <div class="card p-3 shadow-hover mood-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <strong><i class="fas fa-user-circle"></i> {{ mood.username }}</strong>
            {% if mood.anonymous %}
              <span class="badge badge-warning ms-2"><i class="fas fa-user-secret"></i> Anonymous</span>
            {% endif %}
          </div>
          <small class="text-muted"><i class="far fa-clock"></i> {{ mood.created_at.strftime('%b %d, %H:%M') }}</small>
        </div>
        
        <p style="font-size: 1.05rem; line-height: 1.6;">{{ mood.content }}</p>
        
        <div class="mb-3">
          {% if mood.emotion == 'positive' %}
            <span class="emotion-badge emotion-positive"><i class="fas fa-smile-beam"></i> {{ mood.emotion }}</span>
          {% elif mood.emotion == 'negative' %}
            <span class="emotion-badge emotion-negative"><i class="fas fa-sad-tear"></i> {{ mood.emotion }}</span>
          {% else %}
            <span class="emotion-badge emotion-neutral"><i class="fas fa-meh"></i> {{ mood.emotion }}</span>
          {% endif %}
        </div>
        
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex gap-2">
            <form method="POST" action="{{ url_for('react_to_mood', post_id=mood.id, emoji='üëç') }}" style="display:inline;">
              <button class="btn btn-sm btn-outline-primary reaction-btn" type="submit">
                üëç <span class="count">{{ mood.reactions.get('üëç',0) }}</span>
              </button>
            </form>
            <form method="POST" action="{{ url_for('react_to_mood', post_id=mood.id, emoji='‚ù§Ô∏è') }}" style="display:inline;">
              <button class="btn btn-sm btn-outline-danger reaction-btn" type="submit">
                ‚ù§Ô∏è <span class="count">{{ mood.reactions.get('‚ù§Ô∏è',0) }}</span>
              </button>
            </form>
            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#comments-{{ mood.id }}">
              <i class="fas fa-comment"></i> {{ mood.comments|length }}
            </button>
          </div>
          <div>
            {% if user and mood.user_id == user.id %}
            <a href="{{ url_for('edit_mood', post_id=mood.id) }}" class="btn btn-sm btn-warning">
              <i class="fas fa-edit"></i>
            </a>
            <a href="{{ url_for('delete_mood', post_id=mood.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Delete this mood?')">
              <i class="fas fa-trash"></i>
            </a>
            {% endif %}
          </div>
        </div>

        <!-- Comments Section -->
        <div class="collapse" id="comments-{{ mood.id }}">
          <hr>
          <div class="comments-section">
            {% for c in mood.comments %}
            <div class="p-2 mb-2 rounded" style="background: linear-gradient(135deg, #f9fafb, #f3f4f6);">
              <strong><i class="fas fa-user"></i> {{ c.user }}:</strong> {{ c.text }}
              <br><small class="text-muted">{{ c.created_at.strftime('%b %d, %H:%M') }}</small>
            </div>
            {% endfor %}
            
            <form method="POST" action="{{ url_for('comment_post', post_id=mood.id) }}" class="comment-form mt-3">
              <div class="input-group">
                <input type="text" name="comment" class="form-control" placeholder="Add a comment..." required>
                <button class="btn btn-secondary" type="submit">
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  
  {% if not moods %}
  <div class="text-center py-5">
    <i class="fas fa-heart-broken" style="font-size: 4rem; color: #d1d5db;"></i>
    <h4 class="mt-3 text-muted">No mood posts yet</h4>
    <p class="text-muted">Be the first to share your feelings!</p>
  </div>
  {% endif %}
</div>
{% endblock %}
